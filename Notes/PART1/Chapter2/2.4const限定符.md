# 2.4 const限定符

可以用关键字**const**对变量的类型加以限定。const对象一旦创建后其值就不能再改变，所以const对象**必须初始化**，初始值可以是任意复杂的表达式。

```cpp
const int i = get_size();	//正确：运行时初始化
const int j = 42;			//正确：编译时初始化
const int k;				//错误：k是一个未经初始化的常量
```

const类型的操作限制：只能在const类型的对象上执行不改变其内容的操作。



#### extern关键字

默认状态下，const对象仅在文件内有效。如果需要让const对象在多个文件间共享，解决的方法是：

对于const变量，不管是声明还是定义都**添加extern关键字**，这样秩序定义一次就可以了。

```cpp
//file_1.cc定义并初始化了一个常量，该常量能被其他文件访问
extern const int val = fcn();
//file_1.h头文件
extern const int val;//与file_1.cc中定义的val是同一个
```



### 2.4.1 const的引用

可以把引用绑定到const对象上，我们称之为**对常量的引用**（referrence to const）。

定义对常量的引用时注意：

- 引用及其对应的对象**都应是常量**，不能让一个非常量引用指向一个常量对象
- 对常量的引用与普通引用的区别在于：对常量的引用不能被用作修改它所绑定的对象。
- 引用的对象是常量还是非常量可以决定其所能参与的操作，却不会影响到引用和对象的绑定关系本身。



#### 初始化和对const的引用

2.3.1中提到，引用的类型必须与其所引用对象的类型一致，但有两种例外，其一就是在初始化常量引用时允许**用任意表达式作为初始值**，只要该表达式的结果可以**转换**成引用的类型即可。

```cpp
//如以下定义都是正确的。
int i = 42;
const int &r1 = i;
const int &r2 = r1 * 2;
```

**对const的引用可能引用一个非const的对象**，此时允许通过除引用以外的其他途径改变这个对象的值。





### 2.4.2 指针和const

也可以令指针指向常量。类似于常量引用，**指向常量的指针**（pointer to const）不能用于改变所指对象的值。

注意：要想存放常量的地址，只能使用指向常量的指针。

​			但允许令一个指向常量的指针指向一个非常量对象，此时允许通过除指针以外的其他途径改变这个对象的值。



#### const指针

因为指针是对象，所以允许把指针本身定义为常量，即**常量指针**（const pointer）。

**定义方式**：把**const**关键字放在*后。

​					且**必须初始化**，一旦初始化完成，则它的值不可再改变。

注意：常量指针仍可以通过指针修改所指对象的值，只要所指对象不是常量。（也就是说能否修改所指对象的值取决于对象的类型）



### 2.4.3 顶层const

**顶层const**（top-level const）：表示**指针本身**是个常量。

**底层const**（low-level const）：表示指针**所指的对象**是一个常量。

更一般的：

**顶层const**（top-level const）：表示**任意的对象**是常量，这一点对任何数据类型都适用。

**底层const**（low-level const）：与指针和引用等**复合类型**的基本类型部分有关。

比较特殊的是：指针类型既可以是顶层也可以是底层const。



对底层const来说，当执行对象的拷贝操作时，拷入和拷出的对象必须具有**相同的底层const资格**，或者两个对象的数据类型必须可以**转换**。一般来说，**非常量可以转换成常量**，反之则不行。





### 2.4.4 constexpr和常量表达式

**常量表达式**（const expression）指值不会改变，并且在**编译过程**中就能得到计算结果的表达式。

一个对象（或表达式）是不是常量表达式，由它的**数据类型**和**初始值**共同决定。字面值、用常量表达式初始化的const对象都是常量表达式。

注意：```const int a = get_size()```不是常量表达式，因为它的具体值直到运行时才能获取到。



#### constexptr变量

C++11允许将变量声明为**constexpr**类型，以便由编译器来验证变量的值是否为一个常量表达式。

声明为constexpr的变量一定是一个常量，且必须用常量表达式初始化。



#### 字面值类型

常量表达式的值需要在编译时就得到计算，因此对声明constexpr时用到的类型必须有所限制。因为这些类型一般比较简单，值也显而易见且容易得到，所以称它们为**字面值类型**（literal type）。

目前接触过的数据类型中：**算数类型、引用和指针**属于字面值类型；自定义类（如Sales_item）、IO库、string类型不属于字面值类型。其他字面值类型将在后续介绍。

注意：constexpr指针

- 初始值必须是nullptr或0，或是存储于某个固定地址中的对象（这个概念后续也会细讲）
- 限定符constexpr仅对指针有效，与指针所指的对象无关。即constexpr指针本身是常量指针，但它既可以指向常量，也可以指向非常量。