# 自定义数据类型

从最基本的层面理解，数据结构是把一组相关的数据元素组织起来然后使用它们的策略和方法。C++允许用户以类的形式自定义数据类型，库类型string、istream、ostream等也都是以类的形式定义的。



### 2.6.1 定义Sales_data类型

```cpp
struct Sales_data{
    std::string bookNo;
    unsigned units_sold = 0;
    double revenue = 0.0;
};//不要忘记分号，表示声明符的结束
```

例中的类以关键字**struct**开始，紧跟着**类名**和**类体**（类体可以为空）。类体由花括号包围形成新的作用域，类内部定义的变量名必须唯一，但可以与类外部定义的名字重复。

定义时，建议**对象和类分开定义**。

#### 类数据成员

类体定义类的**成员**，此例中的类只有**数据成员**（data member）。

类的数据成员定义了类的对象的具体内容，每个对象有自己的一份数据成员拷贝。修改一个对象的数据成员，不会影响其他的同类对象。

数据成员的**定义方式**：

- 与普通变量一样：首先说明一个基本类型，随后紧跟一个或多个声明符。

- C++11新标准规定：可以为数据成员提供一个**类内初始值**（in-class initializer），用于初始化数据成员。

  创建对象时，没有初始值的成员将被默认初始化。



### 2.6.2 使用Sales_data类

详见书本，主要步骤为：

1. 添加两个Sales_data对象
2. Sales_data对象读入数据
3. 输出两个Sales_data对象的和



### 2.6.3 编写自己的头文件

为确保各个文件中类的定义一致，类通常被定义在**头文件**中，而且类所在头文件的名字应与类的名字一样。

头文件通常包含那些**只能被定义一次的实体**，如类、const和constexpr变量等。头文件也经常用到其他头文件的功能，因此有必要在书写头文件时做适当的处理，使其遇到多次包含的情况也能安全和正常地工作。

头文件一旦改变，相关的源文件必须重新编译以获取更新过的声明。

#### 预处理器概述

确保头文件多次包含仍能安全工作的常用技术是**预处理器**（preprocessor），它是在**编译之前**执行的一段程序，可以部分地改变我们所写的程序。

目前已接触的预处理功能：`#include`

另一重要预处理功能：**头文件保护符**（header guard）。

- 头文件保护符依赖于**预处理变量**。预处理变量无视C++中作用域的规则，它有两种状态：已定义和未定义。
- 指令：
  - `#define`：把一个名字设定为预处理变量
  - `#ifdef`和`#ifndef`：检查某个指定的预处理变量是否已经定义
  - `#endif`：一旦检查结果为真，则执行后续操作直到遇见该指令位置

整个程序中预处理变量包括头文件保护符必须唯一，为了确保唯一性，通常基于头文件中类的名字来构建保护符的名字，并把名字全部大写。